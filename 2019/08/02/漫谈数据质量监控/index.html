<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="数据质量[转载]"><meta name="keywords" content="数据仓库,数据质量"><meta name="author" content="zhiyong.chen"><meta name="copyright" content="zhiyong.chen"><title>数据质量[转载] | Shadowchenxx's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#漫谈数据质量监控"><span class="toc-number">1.</span> <span class="toc-text">漫谈数据质量监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文章结构"><span class="toc-number">1.1.</span> <span class="toc-text">文章结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#什么值得你监控"><span class="toc-number">2.</span> <span class="toc-text">什么值得你监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、-监控"><span class="toc-number">2.1.</span> <span class="toc-text">一、 监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、告警"><span class="toc-number">2.2.</span> <span class="toc-text">二、告警</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、-多数据源"><span class="toc-number">2.3.</span> <span class="toc-text">三、 多数据源</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#怎样监控"><span class="toc-number">3.</span> <span class="toc-text">怎样监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、-规则引擎"><span class="toc-number">3.1.</span> <span class="toc-text">一、 规则引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Sql模板"><span class="toc-number">3.1.1.</span> <span class="toc-text">1. Sql模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-元数据"><span class="toc-number">3.1.2.</span> <span class="toc-text">2. 元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-自定义模板"><span class="toc-number">3.1.3.</span> <span class="toc-text">3. 自定义模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、执行引擎"><span class="toc-number">3.2.</span> <span class="toc-text">二、执行引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Sql执行"><span class="toc-number">3.2.1.</span> <span class="toc-text">1. Sql执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-直接获取数据量"><span class="toc-number">3.2.2.</span> <span class="toc-text">2. 直接获取数据量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-算法执行引擎"><span class="toc-number">3.2.3.</span> <span class="toc-text">3. 算法执行引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-多数据源"><span class="toc-number">3.2.4.</span> <span class="toc-text">4. 多数据源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据校验"><span class="toc-number">4.</span> <span class="toc-text">数据校验</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">zhiyong.chen</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">66</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">64</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Shadowchenxx's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">数据质量[转载]</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-02</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="漫谈数据质量监控"><a href="#漫谈数据质量监控" class="headerlink" title="漫谈数据质量监控"></a>漫谈数据质量监控</h1><blockquote>
<p>往往那些不起眼的功能，最能毁掉你的工作成果。</p>
</blockquote>
<p>本篇分享一些和数据质量监控相关的内容。数据质量监控是一个在快速发展的业务中最容易被牺牲和忽略的功能，但是它确实至关重要的。</p>
<a id="more"></a>

<h2 id="文章结构"><a href="#文章结构" class="headerlink" title="文章结构"></a>文章结构</h2><p>数据质量监控的意义和价值就不再谈了，本文主要讨论下面三个主题：</p>
<ol>
<li>数据质量监控要做哪些监控内容</li>
<li>该怎么做</li>
<li>数据校验</li>
</ol>
<p>文中会涉及到数据仓库其它的一些知识点，请参考之前的文章。</p>
<h1 id="什么值得你监控"><a href="#什么值得你监控" class="headerlink" title="什么值得你监控"></a>什么值得你监控</h1><p>我把数据质量分成三部分来理解：</p>
<ol>
<li>监控</li>
<li>告警</li>
<li>多数据源</li>
</ol>
<h2 id="一、-监控"><a href="#一、-监控" class="headerlink" title="一、 监控"></a>一、 监控</h2><p>监控这一块比较大。整体来讲，我会把它分为这几块：<strong>日常监控、数据对账、性能监控</strong>。</p>
<p><strong>日常监控</strong></p>
<p>日常监控中最重要的一个就是数据落地检查，这应该是所有监控的一个基础，不然没数据你玩个毛啊。</p>
<p>下面是我认为一些比较常用的监控内容：</p>
<ol>
<li>数据落地监控</li>
<li>数据掉0监控：实际扩展一下就是数据量阈值监控，少于某个量就告警</li>
<li>重复数据监控：很多表一定要监控重复数据的，这点至关重要</li>
<li>关键指标监控</li>
<li>数据同比环比监控</li>
</ol>
<p><strong>数据对账</strong></p>
<p>这点主要会体现到实时数据上，特别是Kafka数据落地，必须要有一个监控机制来知道我们的数据落地情况。</p>
<p>当然离线数据同样需要数据对账，对账方法有很多，比如可以和业务库来对比。</p>
<p><strong>性能监控</strong></p>
<p>感觉在性能监控上就是有几个点要注意：</p>
<ol>
<li>查询性能，比如es的某个索引，在不同时间段的查询响应速度，同理presto、hive、kylin这些的查询都需要注意一下，这点可以通过任务监控来观察。</li>
<li>数据读写影响，机器故障影响，这点平常不太关注，不过像es这种，在写入数据的时候其实会影响读数据的，需要监控一下，并做相应调整。</li>
</ol>
<h2 id="二、告警"><a href="#二、告警" class="headerlink" title="二、告警"></a>二、告警</h2><p>告警就不用说了，微信、短信和电话都很有必要。</p>
<p>定期的邮件汇总告警也很有必要。</p>
<p>然后有很多的告警可以考虑一个告警报表系统来展示，特别像是数据量趋势这种监控内容，可视化的对比比较有效。</p>
<h2 id="三、-多数据源"><a href="#三、-多数据源" class="headerlink" title="三、 多数据源"></a>三、 多数据源</h2><p>在目前的大数据场景下，各种开源组件引入的十分多，而且会有新的组件不停地引入，因此要考虑到对不同组件的数据监控。</p>
<p>目前笔者接触比较多的会有Hive（presto、spark sql）、Mysql、ES、Redis、Kylin（主要是构建的cube）这些常用的，但是不能排除图数据库（neo4j、orientdb）和druid这些组件引入的可能性。</p>
<h1 id="怎样监控"><a href="#怎样监控" class="headerlink" title="怎样监控"></a>怎样监控</h1><p>数据监控相对来讲是属于后台系统，不能算是对外的业务系统，一般重要性可能会被挑战，虽说如此，它还是值得一做的。 不过可能要换一些思路来做，如何快速地实现、并抓住核心的功能点是值得深思的一件事。</p>
<blockquote>
<p><em>这里不会有实现，只会有一些设计思路，欢迎来讨论。</em></p>
</blockquote>
<p>如图是一个整体的构思，我先分析几个个人认识比较重要的点。后面会详细地来分析。</p>
<ol>
<li>规则引擎：来定义各种告警规则，可能是一条sql模板，也可能是一些具体的算法。</li>
<li>执行引擎：要来执行各种规则，同时要考虑各种数据源的差异。</li>
<li>元数据系统：数据质量监控本来也算是元数据系统的一部分，我们这分开来讲，但是无论如何，在配置表的告警信息时，还是要和元数据系统结合的。</li>
</ol>
<h2 id="一、-规则引擎"><a href="#一、-规则引擎" class="headerlink" title="一、 规则引擎"></a>一、 规则引擎</h2><p>举几个典型例子：数据延迟到达、数据同比环比、数据趋势、一些定制化算法。</p>
<h3 id="1-Sql模板"><a href="#1-Sql模板" class="headerlink" title="1. Sql模板"></a>1. Sql模板</h3><p><strong>在大多数存储引擎中，通过Sql使用的数据（比如Hive、Mysql）会是比较重要的一种数据，这种数据我们可以考虑用Sql模板。</strong></p>
<p>我们会有一张表或者一些配置文件来定义我们的规则。简单来讲，比如说数据同比环比，我们可以写一个presto的sql模板，来和历史数据进行对比，这种sql很简单，自己写好模板就行。</p>
<p><em>这种模板最简单，也最快，我相信能解决大部分问题。</em></p>
<h3 id="2-元数据"><a href="#2-元数据" class="headerlink" title="2. 元数据"></a>2. 元数据</h3><p>很多数据库都是有元数据管理的，比如Hive，它的表的行数都是在元数据库中有存放的，我们可以直接通过Hive的元数据来抓取表的每天的数据量的。</p>
<p><strong>注意：</strong>这点十分重要，它能节省我们大部分的工作，而且比较稳定，但是能满足的功能比较少。需要结合其它来使用。</p>
<h3 id="3-自定义模板"><a href="#3-自定义模板" class="headerlink" title="3. 自定义模板"></a>3. 自定义模板</h3><p>有很多算法不是简单的sql就能搞定的，而且很多存储系统也不是所有都支持sql。比如es这种。因此就需要一些定制化的算法来实现。</p>
<p>这方面的主要工作量应该是在执行引擎上，但是在规则引擎应该有设计到。</p>
<h2 id="二、执行引擎"><a href="#二、执行引擎" class="headerlink" title="二、执行引擎"></a>二、执行引擎</h2><p>这块应该是比较重要的。 实现起来可以很简单，也可以很复杂。</p>
<h3 id="1-Sql执行"><a href="#1-Sql执行" class="headerlink" title="1. Sql执行"></a>1. Sql执行</h3><p>很多规则都可以通过sql来执行的，这点在规则引擎里面提到了。</p>
<p><strong>其实我很推荐，刚开始的比较粗糙的监控都可以这样来做。</strong> 我们提前配置好大部分的sql模板，然后需要监控哪张表了就在这张表配置一下就行。</p>
<p>具体的执行引擎的话可以考虑presto或者spark sql，特别大的任务可以考虑hive。</p>
<p><strong>优点：</strong></p>
<ol>
<li>简单，方便实现</li>
<li>能满足大部分的需求</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>灵活度不够，比如es，对sql支持太差</li>
<li>速度慢：很多sql执行起来会比较慢，特别是使用hive引擎的时候，会巨慢。</li>
<li>不稳定：一些监控会不太稳定，比如重复数据监控，对一些大的表来讲，用presto这种，是很难出结果的，经常会挂掉，但是换成hive的话又会很慢。</li>
</ol>
<p><strong>那么如何解决？</strong></p>
<p>解决的话，我只有下面几个思路：</p>
<ol>
<li>合理的任务调度，一般集群都是能容纳很多任务的，合适地调度监控任务比较重要。</li>
<li>合理地替换执行引擎，这个下一节会提供一种方案。</li>
<li><strong>合理的任务依赖，比如说是重复数据监控，这点必然会依赖于数据是否到达，如果数据没达到就没必要执行重复数据监控的程序。</strong></li>
</ol>
<h3 id="2-直接获取数据量"><a href="#2-直接获取数据量" class="headerlink" title="2. 直接获取数据量"></a>2. 直接获取数据量</h3><p>前面提到了Sql执行的一个执行效率问题，我们这节提供一个优化的方法。因为Hive目前来讲是十分重要的一种引擎了，所以单说Hive。</p>
<p>Hive是有元数据管理的，它的元数据库中是记录Hive的所有表的记录数的，这些记录数可以直接用作数据量相关的监控，比如数据掉零、数据量环比同比、数据量趋势等。</p>
<h3 id="3-算法执行引擎"><a href="#3-算法执行引擎" class="headerlink" title="3. 算法执行引擎"></a>3. 算法执行引擎</h3><p>很多算法可以通过自定义地方式实现，这一点实现起来就会比较复杂一些。</p>
<p>因为定制化比较强，在设计这一块的话需要一个比较灵活的架构，这里不再展开来讲，因为在常见的数据领域里面，前两点已经能满足很多需求了。</p>
<h3 id="4-多数据源"><a href="#4-多数据源" class="headerlink" title="4. 多数据源"></a>4. 多数据源</h3><p>多数据源这一块，在规则引擎里面需要加一些区分，因为这毕竟和元数据系统关联，区分还是比较简单。</p>
<p>在执行的时候，可能要稍微分开来实现。不过相对来讲不是很复杂。</p>
<h1 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h1><p>数据校验之前是没在意的，现在把这一块补进来。比较偏个人理解，暂时还没形成完整的知识体系。主要就是说如何判断自己的数据是正常的、可以被信任的，这一块在数据质量中应该是十分重要的。</p>
<p>方法的话可以有交叉验证、异常波动监控等，暂时先不分享了，后面自己理清楚了再说。</p>
<p>原文链接:<a href="https://mp.weixin.qq.com/s?__biz=MzUyMjI4MzE0MQ==&amp;mid=2247483847&amp;idx=1&amp;sn=d7c7001a72a9fc4ce578ee256afe609a&amp;ch" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzUyMjI4MzE0MQ==&amp;mid=2247483847&amp;idx=1&amp;sn=d7c7001a72a9fc4ce578ee256afe609a&amp;ch</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">zhiyong.chen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="/http:/yoursite.com/2019/08/02/%E6%BC%AB%E8%B0%88%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%8E%A7/">http://yoursite.com/2019/08/02/%E6%BC%AB%E8%B0%88%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%8E%A7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F/">数据质量</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/08/05/%E5%87%8C%E6%99%A8%E4%B8%89%E7%82%B9/"><i class="fa fa-chevron-left">  </i><span>凌晨三点</span></a></div><div class="next-post pull-right"><a href="/2019/08/01/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%EF%BC%88%E4%BA%8C%EF%BC%89/"><span>数据仓库（二）</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By zhiyong.chen</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>